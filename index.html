<!DOCTYPE html>
<html>
<head>
  <title>RevixMC - Login</title>
  <style>
    body {
      background: #0e0e0e;
      color: white;
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 100px 20px;
    }

    .btn {
      background: #00c3ff;
      color: black;
      padding: 12px 25px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
    }

    #user-info {
      margin-top: 30px;
      font-size: 20px;
    }

    img {
      border-radius: 50%;
      width: 80px;
      margin-top: 20px;
      box-shadow: 0 0 10px #00c3ff;
    }

    #welcomePopup {
      position: fixed;
      top: 30%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #1b1b1b;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 0 30px #00c3ffaa;
      z-index: 9999;
    }

    #welcomePopup button {
      margin-top: 20px;
    }

    .counter {
      margin-top: 40px;
      font-size: 18px;
    }
  </style>
</head>
<body>
  <!-- Welcome Popup -->
  <div id="welcomePopup">
    <h2>Welcome to RevixMC!</h2>
    <p>Enjoy the best PvP experience</p>
    <button class="btn" onclick="closePopup()">Close</button>
  </div>

  <h1>RevixMC Login</h1>
  <p>Login with Discord to continue</p>

  <!-- Login Section -->
  <div id="login-section">
    <a class="btn" href="/auth/discord">Login with Discord</a>
  </div>

  <!-- User Info After Login -->
  <div id="user-info" style="display: none;">
    <p id="username"></p>
    <img id="avatar" src="" alt="User Avatar" />
    <br /><br />
    <a href="/logout"><button class="btn">Logout</button></a>
  </div>

  <!-- Player Counter -->
  <div class="counter">
    <p>Players Online: <span id="playerCount">Loading...</span></p>
  </div>

  <!-- Scripts -->
  <script>
    // Welcome Popup Close
    function closePopup() {
      document.getElementById("welcomePopup").style.display = "none";
    }

    // Get current user from backend
    fetch("/user")
      .then(res => res.json())
      .then(user => {
        if (user && user.username) {
          document.getElementById("login-section").style.display = "none";
          document.getElementById("user-info").style.display = "block";
          document.getElementById("username").innerText = `Welcome, ${user.username}#${user.discriminator}`;
          document.getElementById("avatar").src = `https://cdn.discordapp.com/avatars/${user.id}/${user.avatar}.png`;
        }
      });

    // Minecraft Player Count
    const serverIP = "revixmc.net";
    const playerCountElement = document.getElementById("playerCount");

    async function updatePlayerCount() {
      try {
        const response = await fetch(`https://api.mcsrvstat.us/2/${serverIP}`);
        const data = await response.json();

        if (data.online && data.players) {
          playerCountElement.textContent = data.players.online;
        } else {
          playerCountElement.textContent = "Offline";
        }
      } catch (error) {
        playerCountElement.textContent = "Error";
        console.error("Player count fetch failed:", error);
      }
    }

    updatePlayerCount();
    setInterval(updatePlayerCount, 10000);
  </script>
</body>
</html>
